name: preRequisites
on:
  workflow_call:

jobs:
  check_prerequisites:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check for IT folder
        id: check-it
        run: |
          if [ -d "IT" ]; then
            echo "IT_FOLDER_EXISTS=true" >> $GITHUB_OUTPUT
          else
            echo "IT_FOLDER_EXISTS=false" >> $GITHUB_OUTPUT
          fi
        shell: bash

      - name: Check for Data gen folder
        id: check-datagen
        run: |
          if [ -d "datagen" ]; then
            echo "DATAGEN_FOLDER_EXISTS=true" >> $GITHUB_OUTPUT
          else
            echo "DATAGEN_FOLDER_EXISTS=false" >> $GITHUB_OUTPUT
          fi
        shell: bash

      - name: Log output
        run: |
          echo "IT folder_exists: [${{ steps.check-it.outputs.IT_FOLDER_EXISTS }}]"
          echo "Data gen IT folder_exists: [${{ steps.check-datagen.outputs.DATAGEN_FOLDER_EXISTS }}]"

      - name: Create YAML file
        run: |
          cat <<EOF > ${{ github.workspace }}/pre_requisites.yaml
          IT_FOLDER_EXISTS: ${{ steps.check-it.outputs.IT_FOLDER_EXISTS }}
          DATAGEN_FOLDER_EXISTS: ${{ steps.check-datagen.outputs.DATAGEN_FOLDER_EXISTS }}
          EOF

      - name: Show created file
        run: cat ${{ github.workspace }}/pre_requisites.yaml

      - name: Archive pre-requisites.yaml file
        uses: actions/upload-artifact@v4
        with:
          name: pre_requisites
          path: ${{ github.workspace }}/pre_requisites.yaml

      - name: read-yaml-file
        uses: pietrobolcato/action-read-yaml@1.1.0
        id: read-yaml-file
        with:
          config: ${{ github.workspace }}/pre_requisites.yaml

      - name: display variables
        id: set-env-variable
        run: |
          echo "IT_FOLDER_EXISTS=${{ steps.read-yaml-file.outputs['IT_FOLDER_EXISTS'] }}"
          echo "DATAGEN_FOLDER_EXISTS=${{ steps.read-yaml-file.outputs['DATAGEN_FOLDER_EXISTS'] }}"

      - name: Write to job summary
        run: |
          echo "## Prerequisites Check" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Folder | Exists |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| IT | ${{ steps.check-it.outputs.IT_FOLDER_EXISTS }} |" >> $GITHUB_STEP_SUMMARY
          echo "| datagen | ${{ steps.check-datagen.outputs.DATAGEN_FOLDER_EXISTS }} |" >> $GITHUB_STEP_SUMMARY

